{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { useState, useEffect } from 'react';\nimport Layout from '../components/Layout';\nimport Link from 'next/link';\nimport Navbar from '../components/dashboard/Navbar';\nimport BannerCard from '../components/dashboard/BannerCard';\nimport fetch from 'isomorphic-unfetch';\nimport { store } from 'react-notifications-component';\nimport { withAuthSync, getToken, auth } from '../utils/auth';\nimport { getUserId, hasPaymentMethod } from '../utils/user';\n\nvar Dashboard = function Dashboard(props) {\n  var _useState = useState([]),\n      banners = _useState[0],\n      setBanners = _useState[1];\n\n  var handleEnabledChange =\n  /*#__PURE__*/\n  function () {\n    var _ref = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee(bannerId) {\n      var banner, updateValue, token, res, data, updatedBanners;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              banner = banners.find(function (item) {\n                return item._id === bannerId;\n              });\n              updateValue = !banner.enabled;\n\n              if (checkBanners(bannerId)) {\n                _context.next = 13;\n                break;\n              }\n\n              token = getToken();\n              _context.next = 6;\n              return fetch(\"http://localhost:3600/banners/\".concat(bannerId), {\n                method: \"PATCH\",\n                headers: {\n                  'Content-Type': 'application/json',\n                  'Authorization': 'Bearer ' + token\n                },\n                body: _JSON$stringify({\n                  enabled: updateValue\n                })\n              });\n\n            case 6:\n              res = _context.sent;\n              _context.next = 9;\n              return res.json();\n\n            case 9:\n              data = _context.sent;\n\n              if (!data.error) {\n                updatedBanners = banners.map(function (item) {\n                  if (item._id === bannerId) {\n                    item.enabled = updateValue;\n                  }\n\n                  return item;\n                });\n                setBanners(updatedBanners);\n              }\n\n              _context.next = 14;\n              break;\n\n            case 13:\n              store.addNotification({\n                message: 'You have to disable any other banner before you can enable this one.',\n                type: 'warning',\n                // 'default', 'success', 'info', 'warning'\n                container: 'top-center',\n                // where to position the notifications\n                animationIn: [\"animated\", \"fadeIn\"],\n                // animate.css classes that's applied\n                animationOut: [\"animated\", \"fadeOut\"],\n                // animate.css classes that's applied\n                dismiss: {\n                  duration: 4500\n                },\n                width: 300\n              });\n\n            case 14:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleEnabledChange(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var checkBanners = function checkBanners(bannerId) {\n    var result = false;\n    banners.map(function (item) {\n      if (item.enabled && item._id !== bannerId) {\n        result = true;\n      }\n\n      return item;\n    });\n    return result;\n  };\n\n  useEffect(function () {\n    setBanners(props.banners);\n    var token = getToken();\n    console.log(hasPaymentMethod(token));\n  }, []);\n  return __jsx(Layout, {\n    title: \"Dashboard\"\n  }, __jsx(Navbar, null), __jsx(\"section\", {\n    className: \"uk-section uk-section-muted\",\n    style: {\n      height: '95vh'\n    }\n  }, __jsx(\"div\", {\n    className: \"uk-container\"\n  }, __jsx(\"h2\", {\n    className: \"uk-text-bold\"\n  }, \"My banners\"), __jsx(\"p\", {\n    \"uk-margin\": \"true\"\n  }, __jsx(Link, {\n    href: \"/banner/create\"\n  }, __jsx(\"a\", {\n    className: \"uk-button uk-button-primary\",\n    style: {\n      borderRadius: '0.1875rem'\n    }\n  }, \"New banner\"))), banners.length > 0 ? __jsx(\"div\", null, __jsx(\"div\", {\n    className: \"uk-position-relative\"\n  }, __jsx(\"div\", {\n    className: \"uk-slider-container\"\n  }, __jsx(\"ul\", {\n    className: \"uk-slider-items uk-child-width-1-2@s uk-child-width-1-3@m uk-grid uk-grid-medium\"\n  }, banners.map(function (item, key) {\n    return __jsx(BannerCard, {\n      key: key,\n      banner: item,\n      id: item._id,\n      handleEnabledChange: handleEnabledChange\n    });\n  }))), __jsx(\"div\", {\n    className: \"uk-hidden@m uk-light\"\n  }, __jsx(\"a\", {\n    className: \"uk-position-center-left uk-position-small\",\n    href: \"#\",\n    \"data-uk-slidenav-previous\": true,\n    \"data-uk-slider-item\": \"previous\"\n  }), __jsx(\"a\", {\n    className: \"uk-position-center-right uk-position-small\",\n    href: \"#\",\n    \"data-uk-slidenav-next\": true,\n    \"data-uk-slider-item\": \"next\"\n  })), __jsx(\"div\", {\n    className: \"uk-visible@m\"\n  }, __jsx(\"a\", {\n    className: \"uk-position-center-left-out uk-position-small\",\n    href: \"#\",\n    \"data-uk-slidenav-previous\": true,\n    \"data-uk-slider-item\": \"previous\"\n  }), __jsx(\"a\", {\n    className: \"uk-position-center-right-out uk-position-small\",\n    href: \"#\",\n    \"data-uk-slidenav-next\": true,\n    \"data-uk-slider-item\": \"next\"\n  })))) : __jsx(\"div\", null))));\n};\n\nDashboard.getInitialProps =\n/*#__PURE__*/\nfunction () {\n  var _ref2 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee2(ctx) {\n    var token, userId, res, banners;\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            token = auth(ctx);\n            userId = getUserId(token);\n            _context2.next = 4;\n            return fetch(\"http://localhost:3600/banners/user/\".concat(userId), {\n              method: \"GET\",\n              headers: {\n                'Authorization': 'Bearer ' + token\n              }\n            });\n\n          case 4:\n            res = _context2.sent;\n            _context2.next = 7;\n            return res.json();\n\n          case 7:\n            banners = _context2.sent;\n            return _context2.abrupt(\"return\", {\n              banners: banners\n            });\n\n          case 9:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n\n  return function (_x2) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nexport default withAuthSync(Dashboard);","map":{"version":3,"sources":["/Users/hugojohnsson/Desktop/banner-app/pages/dashboard.jsx"],"names":["useState","useEffect","Layout","Link","Navbar","BannerCard","fetch","store","withAuthSync","getToken","auth","getUserId","hasPaymentMethod","Dashboard","props","banners","setBanners","handleEnabledChange","bannerId","banner","find","item","_id","updateValue","enabled","checkBanners","token","method","headers","body","res","json","data","error","updatedBanners","map","addNotification","message","type","container","animationIn","animationOut","dismiss","duration","width","result","console","log","height","borderRadius","length","key","getInitialProps","ctx","userId"],"mappings":"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","sourcesContent":["import { useState, useEffect } from 'react';\nimport Layout from '../components/Layout'\nimport Link from 'next/link';\nimport Navbar from '../components/dashboard/Navbar';\nimport BannerCard from '../components/dashboard/BannerCard';\nimport fetch from 'isomorphic-unfetch'\nimport { store } from 'react-notifications-component';\n\nimport { withAuthSync, getToken, auth } from '../utils/auth';\nimport { getUserId, hasPaymentMethod } from '../utils/user';\n\nconst Dashboard = (props) => {\n  const [banners, setBanners] = useState([]);\n\n  const handleEnabledChange = async (bannerId) => {\n    const banner = banners.find(item => item._id === bannerId);\n    const updateValue = !banner.enabled;\n    if (!checkBanners(bannerId)) {\n      const token = getToken();\n      const res = await fetch(`http://localhost:3600/banners/${bannerId}`, {\n        method: \"PATCH\",\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': 'Bearer ' + token\n        },\n        body: JSON.stringify({\n          enabled: updateValue\n        })\n      });\n\n      const data = await res.json();\n      if (!data.error) {\n        const updatedBanners = banners.map(item => {\n          if (item._id === bannerId) {\n            item.enabled = updateValue\n          }\n          return item;\n        });\n        setBanners(updatedBanners);\n      }\n    } else {\n      store.addNotification({\n          message: 'You have to disable any other banner before you can enable this one.',\n          type: 'warning',                         // 'default', 'success', 'info', 'warning'\n          container: 'top-center',                // where to position the notifications\n          animationIn: [\"animated\", \"fadeIn\"],     // animate.css classes that's applied\n          animationOut: [\"animated\", \"fadeOut\"],   // animate.css classes that's applied\n          dismiss: {\n            duration: 4500,\n          },\n          width: 300\n      });\n    }\n  }\n\n  const checkBanners = (bannerId) => {\n    let result = false;\n    banners.map(item => {\n      if (item.enabled && item._id !== bannerId) {\n        result = true;\n      }\n      return item;\n    })\n    return result\n  }\n\n  useEffect(() => {\n    setBanners(props.banners);\n    const token = getToken()\n    console.log(hasPaymentMethod(token))\n  }, [])\n\n  return (\n    <Layout title=\"Dashboard\">\n      <Navbar/>\n  \t\t<section className=\"uk-section uk-section-muted\" style={{height:'95vh'}}>\n        <div className=\"uk-container\">\n  \t\t\t\t<h2 className=\"uk-text-bold\">My banners</h2>\n          <p uk-margin=\"true\">\n            <Link href='/banner/create'><a className=\"uk-button uk-button-primary\" style={{borderRadius:'0.1875rem'}}>New banner</a></Link>\n          </p>\n\n  \t\t\t\t\t\t{\n                banners.length > 0 ?\n                <div>\n        \t\t\t\t\t<div className=\"uk-position-relative\">\n                  <div className=\"uk-slider-container\">\n      \t\t\t\t\t\t\t<ul className=\"uk-slider-items uk-child-width-1-2@s uk-child-width-1-3@m uk-grid uk-grid-medium\">\n      \t\t\t\t\t\t\t  {\n                        banners.map((item, key) => {\n\n                          return (\n                            <BannerCard key={key} banner={item} id={item._id} handleEnabledChange={handleEnabledChange}/>\n                          )\n                        })\n                      }\n      \t\t\t\t\t\t\t</ul>\n      \t\t\t\t\t\t</div>\n                  <div className=\"uk-hidden@m uk-light\">\n      \t\t\t\t\t\t\t<a className=\"uk-position-center-left uk-position-small\" href=\"#\" data-uk-slidenav-previous data-uk-slider-item=\"previous\"></a>\n      \t\t\t\t\t\t\t<a className=\"uk-position-center-right uk-position-small\" href=\"#\" data-uk-slidenav-next data-uk-slider-item=\"next\"></a>\n      \t\t\t\t\t\t</div>\n      \t\t\t\t\t\t<div className=\"uk-visible@m\">\n      \t\t\t\t\t\t\t<a className=\"uk-position-center-left-out uk-position-small\" href=\"#\" data-uk-slidenav-previous data-uk-slider-item=\"previous\"></a>\n      \t\t\t\t\t\t\t<a className=\"uk-position-center-right-out uk-position-small\" href=\"#\" data-uk-slidenav-next data-uk-slider-item=\"next\"></a>\n      \t\t\t\t\t\t</div>\n      \t\t\t\t\t</div>\n      \t\t\t\t</div>\n                :\n                  <div></div>\n              }\n\n  \t\t\t</div>\n  \t\t</section>\n    </Layout>\n  )\n}\n\nDashboard.getInitialProps = async (ctx) => {\n  const token = auth(ctx);\n  const userId = getUserId(token);\n  const res = await fetch(`http://localhost:3600/banners/user/${userId}`, {\n    method: \"GET\",\n    headers: {\n      'Authorization': 'Bearer ' + token\n    }\n  });\n  const banners = await res.json();\n\n  return { banners }\n}\n\nexport default withAuthSync(Dashboard);\n"]},"metadata":{},"sourceType":"module"}
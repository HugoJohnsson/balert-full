{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { useState, useEffect } from 'react';\nimport Layout from '../components/Layout';\nimport Link from 'next/link';\nimport Navbar from '../components/dashboard/Navbar';\nimport BannerCard from '../components/dashboard/BannerCard';\nimport fetch from 'isomorphic-unfetch';\nimport { store } from 'react-notifications-component';\nimport { withAuthSync, getToken, auth } from '../utils/auth';\nimport { getUserId, hasPaymentMethod } from '../utils/user';\nimport dynamic from 'next/dynamic';\nvar AddCard = dynamic(function () {\n  return import('../components/payment/AddCard');\n}, {\n  ssr: false,\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak('../components/payment/AddCard')];\n    },\n    modules: ['../components/payment/AddCard']\n  }\n});\n\nvar Billing = function Billing(props) {\n  var _useState = useState(props.user.domain),\n      domain = _useState[0],\n      setDomain = _useState[1];\n\n  var _useState2 = useState(false),\n      showAddCard = _useState2[0],\n      setShowAddCard = _useState2[1];\n\n  var _useState3 = useState(props.user),\n      user = _useState3[0],\n      setUser = _useState3[1];\n\n  var refetchUserData =\n  /*#__PURE__*/\n  function () {\n    var _ref = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var token, userId, res, user;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              token = getToken();\n              userId = getUserId(token);\n              _context.next = 4;\n              return fetch(\"http://localhost:3600/users/\".concat(userId), {\n                method: \"GET\",\n                headers: {\n                  'Authorization': 'Bearer ' + token\n                }\n              });\n\n            case 4:\n              res = _context.sent;\n              _context.next = 7;\n              return res.json();\n\n            case 7:\n              user = _context.sent;\n              setUser(user);\n              return _context.abrupt(\"return\");\n\n            case 10:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function refetchUserData() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var renderContent = function renderContent() {\n    if (!user.hasPayment) {\n      if (!showAddCard) {\n        return __jsx(React.Fragment, null, __jsx(\"p\", null, \"You don't have a payment method attached to your account.\"), __jsx(\"button\", {\n          onClick: function onClick() {\n            return setShowAddCard(true);\n          },\n          className: \"uk-button uk-button-primary\",\n          style: {\n            borderRadius: '0.1875rem'\n          }\n        }, \"Add a card\"));\n      } else {\n        return __jsx(AddCard, {\n          userId: user.id,\n          userEmail: user.email,\n          cancelAddCard: function cancelAddCard() {\n            return setShowAddCard(false);\n          },\n          done: refetchUserData\n        });\n      }\n    } else {\n      return __jsx(\"h1\", null, \"dkasdkls\\xF6a\");\n    }\n  };\n\n  return __jsx(Layout, {\n    title: \"Billing\"\n  }, __jsx(Navbar, null), __jsx(\"section\", {\n    className: \"uk-section uk-section-muted\",\n    style: {\n      height: '95vh'\n    }\n  }, __jsx(\"div\", {\n    className: \"uk-container\"\n  }, __jsx(\"h2\", {\n    className: \"uk-text-bold\"\n  }, \"Billing\"), renderContent())));\n};\n\nBilling.getInitialProps =\n/*#__PURE__*/\nfunction () {\n  var _ref2 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee2(ctx) {\n    var token, userId, res, user;\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            token = auth(ctx);\n            userId = getUserId(token);\n            _context2.next = 4;\n            return fetch(\"http://localhost:3600/users/\".concat(userId), {\n              method: \"GET\",\n              headers: {\n                'Authorization': 'Bearer ' + token\n              }\n            });\n\n          case 4:\n            res = _context2.sent;\n            _context2.next = 7;\n            return res.json();\n\n          case 7:\n            user = _context2.sent;\n            return _context2.abrupt(\"return\", {\n              user: user\n            });\n\n          case 9:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n\n  return function (_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nexport default withAuthSync(Billing);","map":{"version":3,"sources":["/Users/hugojohnsson/Desktop/banner-app/pages/billing.jsx"],"names":["useState","useEffect","Layout","Link","Navbar","BannerCard","fetch","store","withAuthSync","getToken","auth","getUserId","hasPaymentMethod","dynamic","AddCard","ssr","Billing","props","user","domain","setDomain","showAddCard","setShowAddCard","setUser","refetchUserData","token","userId","method","headers","res","json","renderContent","hasPayment","borderRadius","id","email","height","getInitialProps","ctx"],"mappings":"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","sourcesContent":["import { useState, useEffect } from 'react';\nimport Layout from '../components/Layout'\nimport Link from 'next/link';\nimport Navbar from '../components/dashboard/Navbar';\nimport BannerCard from '../components/dashboard/BannerCard';\nimport fetch from 'isomorphic-unfetch'\nimport { store } from 'react-notifications-component';\n\nimport { withAuthSync, getToken, auth } from '../utils/auth';\nimport { getUserId, hasPaymentMethod } from '../utils/user';\n\nimport dynamic from 'next/dynamic'\n\nconst AddCard = dynamic(\n  () => import('../components/payment/AddCard'),\n  { ssr: false }\n)\n\nconst Billing = (props) => {\n  const [domain, setDomain] = useState(props.user.domain);\n  const [showAddCard, setShowAddCard] = useState(false);\n  const [user, setUser] = useState(props.user);\n\n  const refetchUserData = async () => {\n    const token = getToken();\n    const userId = getUserId(token);\n    const res = await fetch(`http://localhost:3600/users/${userId}`, {\n      method: \"GET\",\n      headers: {\n        'Authorization': 'Bearer ' + token\n      }\n    });\n    const user = await res.json();\n    setUser(user);\n    return\n  }\n\n  const renderContent = () => {\n    if (!user.hasPayment) {\n      if (!showAddCard) {\n        return (\n          <>\n            <p>You don't have a payment method attached to your account.</p>\n            <button onClick={() => setShowAddCard(true)} className=\"uk-button uk-button-primary\" style={{borderRadius:'0.1875rem'}}>Add a card</button>\n          </>\n        )\n      } else {\n        return (\n          <AddCard userId={user.id} userEmail={user.email} cancelAddCard={() => setShowAddCard(false)} done={refetchUserData}/>\n        )\n      }\n    } else {\n      return <h1>dkasdkls√∂a</h1>\n    }\n  }\n\n  return (\n    <Layout title=\"Billing\">\n      <Navbar/>\n  \t\t<section className=\"uk-section uk-section-muted\" style={{height:'95vh'}}>\n        <div className=\"uk-container\">\n  \t\t\t\t<h2 className=\"uk-text-bold\">Billing</h2>\n          {\n            renderContent()\n          }\n  \t\t\t</div>\n  \t\t</section>\n    </Layout>\n  )\n}\n\nBilling.getInitialProps = async (ctx) => {\n  const token = auth(ctx);\n  const userId = getUserId(token);\n  const res = await fetch(`http://localhost:3600/users/${userId}`, {\n    method: \"GET\",\n    headers: {\n      'Authorization': 'Bearer ' + token\n    }\n  });\n  const user = await res.json();\n\n  return { user }\n}\n\nexport default withAuthSync(Billing);\n"]},"metadata":{},"sourceType":"module"}